<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poker Game</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Split CSS files -->
    <link rel="stylesheet" href="/static/css/base.css">
    <link rel="stylesheet" href="/static/css/background.css">
    <link rel="stylesheet" href="/static/css/layout.css">
    <link rel="stylesheet" href="/static/css/components.css">
    <link rel="stylesheet" href="/static/css/features.css">
    <link rel="stylesheet" href="/static/css/screens.css">
    <link rel="stylesheet" href="/static/css/animations.css">
    <link rel="stylesheet" href="/static/css/responsive.css">
    <style>
        /* Fade transition styles for splash and startup screens */
        #splash-screen {
            opacity: 1;
            transition: opacity 0.8s ease;
        }
        #splash-screen.fade-out {
            opacity: 0;
            pointer-events: none;
        }
        #startup-screen {
            opacity: 0;
            transition: opacity 0.8s ease;
            pointer-events: none;
        }
        #startup-screen.active {
            opacity: 1;
            pointer-events: auto;
        }
        /* Video intro styles */
        #video-intro-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 9998;
            display: none;
        }
        #video-intro-container.active {
            opacity: 1;
            pointer-events: auto;
        }
        /* Background fade transition */
        .background {
            transition: background-image 0.5s ease;
        }
        #starfield {
            transition: opacity 0.5s ease;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Background -->
        <!-- Splash Screen -->
        <div id="splash-screen" class="screen active">
            <div class="splash-container">
                <img src="/static/assets/images/main.jpg" alt="Game Splash" class="splash-image">
                <div class="splash-overlay">
                    <div class="splash-text">
                        <p>Click anywhere to start</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="background">
            <!-- Video Intro Container -->
            <div id="video-intro-container">
                <video id="intro-video" width="100%" height="100%" preload="auto">
                    <source src="/static/assets/video/poker_game_intro.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </div>
            
            <canvas id="starfield"></canvas>
            <div class="bg-gradient"></div>
            <div class="bg-pattern"></div>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <!-- Live Score Preview Panel -->
            <div id="live-score-preview" class="glass-panel live-preview-panel"> 
                <h4 id="preview-title" class="preview-title">
                    <span class="info-label">Round</span>
                    <span id="current-round" class="info-value">1</span>
                </h4>
                <!-- Game Info Items Moved Here -->
                <div class="game-info-preview">
                    <div class="info-item">
                        <span class="info-label">Score</span>
                        <span id="total-score" class="info-value">0</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Money</span>
                        <span id="player-money" class="info-value">$0</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Target</span>
                        <span id="round-target" class="info-value">300</span>
                    </div>
                    <div class="info-group-hands-draws">
                        <div class="info-item">
                            <span class="info-label">Hands</span>
                            <span id="hands-played" class="info-value">0</span>/<span id="max-hands" class="info-value">4</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Draws</span>
                            <span id="draws-used" class="info-value">0</span>/<span id="max-draws" class="info-value">3</span>
                        </div>
                    </div>
                </div>
                
                <!-- Preview Mode Content -->
                <div id="preview-mode-content">
                    <div class="preview-item">
                        <span class="preview-label">Type:</span>
                        <span id="preview-hand-type" class="preview-value">-</span>
                    </div>
                    <div class="preview-item">
                        <span class="preview-label">Base Score:</span>
                        <span id="preview-base-score" class="preview-value">-</span>
                    </div>
                </div>
                
                <!-- Scoring Mode Content -->
                <div id="scoring-mode-content" style="display: none;">
                    <div class="preview-item">
                        <span class="preview-label">Card Chips:</span>
                        <span id="live-card-chips" class="preview-value">0</span>
                    </div>
                    <div class="preview-item">
                        <span class="preview-label">Base Chips:</span>
                        <span id="live-base-chips" class="preview-value">0</span>
                    </div>
                    <div class="preview-item">
                        <span class="preview-label">Multiplier:</span>
                        <span id="live-multiplier" class="preview-value">√ó1</span>
                    </div>
                    <div class="preview-item total">
                        <span class="preview-label">Total Score:</span>
                        <span id="live-total-score" class="preview-value">0</span>
                    </div>
                    <div id="live-bonus-effects" class="bonus-effects-container"></div>
                </div>
                
                <p id="preview-description" class="preview-description-text"></p>
                <button id="show-payouts-btn" class="btn btn-secondary btn-small">
                    <span class="btn-icon">üèÜ</span>
                    Payouts
                </button>
            </div>
                <!-- Turbo-Chip Inventory -->
                <div id="inventory-panel" class="glass-panel inventory-panel">
                    <h4 class="preview-title">Inventory</h4>
                    <div id="inventory-slots" class="inventory-slots"></div>
                </div>
            <!-- Wrapper for the rest of the game content -->
            <div class="main-game-content-wrapper">
                <!-- Game Header -->
                <div class="game-header">
                    <!-- Content moved to live-score-preview -->
                </div>

                <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  LIVE SCORING AREA  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
                <div id="scoring-area" class="scoring-area">
                    <div class="glass-panel scoring-live-panel">
                        <h3 class="scoring-live-title">Total Score</h3>
                        <div class="scoring-live-values">
                            <span id="live-chip-total" class="chip-total">0</span>
                            <span class="multiply-symbol">√ó</span>
                            <span id="live-mult-total" class="mult-total">1</span>
                            <span class="equals-symbol">=</span>
                            <span id="live-final-total" class="final-total">0</span>
                        </div>
                    </div>

                    <!-- played cards clone into this row -->
                    <div id="scoring-card-row" class="scoring-card-row"></div>
                </div>

                <!-- Hand Area -->
                <div class="hand-area">
                    <div class="glass-panel hand-panel">
                        <h3 class="hand-title">Your Hand</h3>
                        <div id="player-hand" class="card-container">
                            <!-- Cards will be dynamically added here -->
                        </div>
                    </div>
                </div>

                <!-- Action Area -->
                <div class="action-area">
                    <div class="glass-panel action-panel">
                        <div class="action-buttons">
                            <button id="draw-cards-btn" class="btn btn-secondary" disabled>
                                DRAW
                            </button>
                            <button id="play-hand-btn" class="btn btn-primary" disabled>
                                PLAY
                            </button>
                            <button id="sort-rank-btn" class="btn btn-secondary">
                                RANK
                            </button>
                            <button id="sort-suit-btn" class="btn btn-secondary">
                                SUIT
                            </button>
                        </div>
                        <div class="selection-info">
                            <span id="selection-count">0</span> cards selected
                        </div>
                    </div>
                </div>

                <!-- Deck Info -->
                <div class="deck-info">
                    <div id="deck-info-panel" class="glass-panel deck-panel clickable">
                        <div class="deck-icon">üÇ†</div>
                        <!-- Deck count text removed -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Startup Screen -->
        <div id="startup-screen" class="screen">
            <div class="glass-panel main-menu">
                <h1 class="game-title">
                    <span class="title-icon">‚ô†</span>
                    Poker Game
                    <span class="title-icon">‚ô•</span>
                </h1>
                <p class="game-subtitle">Single Player Poker Challenge</p>
                
                <div class="menu-buttons">
                    <button id="start-game-btn" class="btn btn-primary">
                        <span class="btn-icon">üéÆ</span>
                        Start Game
                    </button>
                    <button id="highscores-btn" class="btn btn-secondary">
                        <span class="btn-icon">üèÜ</span>
                        Highscores
                    </button>
                    <button id="start-debug-game-btn" class="btn btn-secondary" style="background-color: rgba(255, 165, 0, 0.2); border-color: rgba(255, 165, 0, 0.4);">
                        <span class="btn-icon">üêû</span>
                        Start Debug Mode
                    </button>
                </div>
            </div>
        </div>

        <!-- Victory Screen -->
        <div id="victory-screen" class="screen">
            <div class="glass-panel victory-panel">
                <div class="victory-content">
                    <h1 class="victory-title">üéâ VICTORY! üéâ</h1>
                    <p class="victory-message">Congratulations! You've completed all 3 rounds!</p>
                    
                    <div class="final-score">
                        <span class="final-score-label">Final Score:</span>
                        <span id="final-score" class="final-score-value">0</span>
                    </div>
                    
                    <div class="victory-actions">
                        <button id="save-score-btn" class="btn btn-primary">
                            <span class="btn-icon">üíæ</span>
                            Save Score
                        </button>
                        <button id="play-again-btn" class="btn btn-secondary">
                            <span class="btn-icon">üîÑ</span>
                            Play Again
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Over Screen -->
        <div id="game-over-screen" class="screen">
            <div class="glass-panel game-over-panel">
                <div class="game-over-content">
                    <h1 class="game-over-title">Game Over</h1>
                    <p class="game-over-message">You didn't reach the target score in time.</p>
                    
                    <div class="final-score">
                        <span class="final-score-label">Final Score:</span>
                        <span id="game-over-score" class="final-score-value">0</span>
                    </div>
                    
                    <div class="name-input-section">
                        <label for="player-name">Enter your name:</label>
                        <input type="text" id="player-name" class="name-input" placeholder="Your name" maxlength="20">
                    </div>
                    
                    <div class="game-over-actions">
                        <button id="save-game-over-score-btn" class="btn btn-primary">
                            <span class="btn-icon">üíæ</span>
                            Save Score
                        </button>
                        <button id="try-again-btn" class="btn btn-secondary">
                            <span class="btn-icon">üîÑ</span>
                            Try Again
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Highscores Screen -->
        <div id="highscores-screen" class="screen">
            <div class="glass-panel highscores-panel">
                <h2 class="highscores-title">üèÜ High Scores</h2>
                
                <div id="highscores-list" class="highscores-list">
                    <!-- Highscores will be dynamically added here -->
                </div>
                
                <button id="back-to-menu-btn" class="btn btn-secondary">
                    <span class="btn-icon">‚¨ÖÔ∏è</span>
                    Back to Menu
                </button>
            </div>
        </div>

        <!-- Shop Screen -->
        <div id="shop-screen" class="screen">
            <div class="glass-panel shop-panel">
                <div class="shop-header">
                    <h2 class="shop-title">Card Shop</h2>
                    <p class="shop-subtitle">Buy cards for the next round!</p>
                    <div class="shop-money">
                        <span class="money-label">Your Money:</span>
                        <span id="shop-money-display" class="money-value">$0</span>
                    </div>
                </div>
                
                <div class="shop-cards-container">
                    <div id="shop-cards" class="shop-cards">
                        <!-- Shop cards will be dynamically added here -->
                    </div>
                </div>
                
                <div class="shop-info">
                    <div class="shop-info-item">
                        <span class="info-icon">üí∞</span>
                        <span class="info-text">Card Cost: $3</span>
                    </div>
                    <div class="shop-info-item">
                        <span class="info-icon">üîÑ</span>
                        <span class="info-text">Reroll Cost: $1</span>
                    </div>
                </div>
                
                <div class="shop-actions">
                    <button id="reroll-shop-btn" class="btn btn-secondary">
                        <span class="btn-icon">üîÑ</span>
                        Reroll Cards ($1)
                    </button>
                    <button id="next-round-btn" class="btn btn-primary">
                        <span class="btn-icon">‚û°Ô∏è</span>
                        Next Round
                    </button>
                </div>
            </div>
        </div>

        <!-- Name Input Modal -->
        <div id="name-modal" class="modal">
            <div class="modal-content glass-panel">
                <h3>Save Your Score</h3>
                <div class="name-input-section">
                    <label for="modal-player-name">Enter your name:</label>
                    <input type="text" id="modal-player-name" class="name-input" placeholder="Your name" maxlength="20">
                </div>
                <div class="modal-actions">
                    <button id="save-name-btn" class="btn btn-primary">Save</button>
                    <button id="cancel-name-btn" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Payouts Modal -->
        <div id="payouts-modal" class="modal">
            <div class="modal-content glass-panel">
                <h3>Hand Rankings & Payouts</h3>
                <div class="payouts-table-container">
                    <table id="payouts-table">
                        <thead>
                            <tr>
                                <th>Hand</th>
                                <th>Base Chips</th>
                                <th>Multiplier</th>
                            </tr>
                        </thead>
                        <tbody id="payouts-table-body"></tbody>
                    </table>
                </div>
                <button id="close-payouts-btn" class="btn btn-secondary">Close</button>
            </div>
        </div>

        <!-- Remaining Deck Modal -->
        <div id="remaining-deck-modal" class="modal">
            <div class="modal-content glass-panel remaining-deck-content">
                <h3>Cards Remaining in Deck</h3>
                <div id="remaining-deck-display" class="remaining-deck-grid">
                    <!-- Cards will be dynamically added here by suit -->
                    <div class="suit-row" id="remaining-spades"><h4>Spades ‚ô†</h4><div class="card-list"></div></div>
                    <div class="suit-row" id="remaining-hearts"><h4>Hearts ‚ô•</h4><div class="card-list"></div></div>
                    <div class="suit-row" id="remaining-clubs"><h4>Clubs ‚ô£</h4><div class="card-list"></div></div>
                    <div class="suit-row" id="remaining-diamonds"><h4>Diamonds ‚ô¶</h4><div class="card-list"></div></div>
                </div>
                <button id="close-remaining-deck-btn" class="btn btn-secondary">
                    Close
                </button>
            </div>
        </div>
    </div>

    <script src="/static/js/modules/ApiClient.js"></script>
    <script src="/static/js/modules/GameState.js"></script>
    <script src="/static/js/modules/CardManager.js"></script>
    <script src="/static/js/modules/TurboIcons.js"></script>
    <script src="/static/js/modules/ScreenManager.js"></script>
    <script src="/static/js/modules/UIUpdater.js"></script>
    <script src="/static/js/modules/TooltipManager.js"></script>
    <script src="/static/js/modules/EffectDescriptions.js"></script>
    <script src="/static/js/modules/PreviewManager.js"></script>
    <script src="/static/js/modules/GameAnimations.js"></script>
    <script src="/static/js/modules/SoundManager.js"></script>
    <script src="/static/js/modules/ScoringAnimationManager.js"></script>
    <script src="/static/js/game.js"></script>
    <script src="/static/js/starfield.js"></script>
    <script src="/static/js/animations.js"></script>
    <script>
        // Handle splash screen with fade transition
        document.addEventListener('DOMContentLoaded', function() {
            const splashScreen = document.getElementById('splash-screen');
            const startupScreen = document.getElementById('startup-screen');
            const videoContainer = document.getElementById('video-intro-container');
            const background = document.querySelector('.background');
            const introVideo = document.getElementById('intro-video');
            const starfield = document.getElementById('starfield');

            // Function to set main menu background image with fade
            function showMainMenuBackground() {
                // Fade out starfield
                starfield.style.opacity = "0";
                // After fade out, set background image
                setTimeout(() => {
                    background.style.backgroundImage = "url('/static/assets/images/mainbackdrop.jpg')";
                    background.style.backgroundSize = "cover";
                    background.style.backgroundPosition = "center";
                }, 500);
            }

            // Function to clear background image and show starfield with fade
            function showGameBackground() {
                // Fade out background image
                background.style.backgroundImage = "";
                // Fade in starfield after a short delay
                setTimeout(() => {
                    starfield.style.opacity = "1";
                }, 100);
            }

            // Function to skip video and go to main menu
            function skipVideoAndShowMenu() {
                introVideo.pause();
                videoContainer.style.display = 'none'; // Hide the video container
                showMainMenuBackground();
                startupScreen.classList.add('active');
                initializeGame();
            }

            // Handle splash screen click
            splashScreen.addEventListener('click', function() {
                splashScreen.classList.remove('active');
                
                // Show and play the intro video
                videoContainer.style.display = 'block';
                introVideo.play().catch(err => {
                    console.error('Error playing video:', err);
                    skipVideoAndShowMenu(); // Fallback if video fails to play
                });
                
                // Skip video when it ends
                introVideo.addEventListener('ended', skipVideoAndShowMenu);
                
                // Skip video on click or key press
                videoContainer.addEventListener('click', skipVideoAndShowMenu);
                // document.addEventListener('keydown', skipVideoAndShowMenu); // Removed to prevent keys from returning to menu
            });

            // Intercept the start game button click to ensure video is stopped
            document.getElementById('start-game-btn').addEventListener('click', function() {
                // Make sure video is paused and container is hidden
                introVideo.pause();
                videoContainer.style.display = 'none';
                // Show game background (starfield)
                showGameBackground();
            });
            
            // Also intercept debug mode button
            document.getElementById('start-debug-game-btn').addEventListener('click', function() {
                introVideo.pause();
                videoContainer.style.display = 'none';
                showGameBackground();
            });

            // Listen for events to return to main menu (victory, game over, back to menu)
            // Assuming buttons with these IDs exist and are used to return to menu
            const backToMenuBtn = document.getElementById('back-to-menu-btn');
            const playAgainBtn = document.getElementById('play-again-btn');
            const tryAgainBtn = document.getElementById('try-again-btn');

            function returnToMainMenu() {
                // Show main menu screen
                startupScreen.classList.add('active');
                // Hide other screens
                document.getElementById('victory-screen').classList.remove('active');
                document.getElementById('game-over-screen').classList.remove('active');
                document.getElementById('highscores-screen').classList.remove('active');
                document.getElementById('shop-screen').classList.remove('active');
                document.getElementById('game-screen').classList.remove('active');
                // Show main menu background
                showMainMenuBackground();
            }

            if (backToMenuBtn) {
                backToMenuBtn.addEventListener('click', returnToMainMenu);
            }
            if (playAgainBtn) {
                playAgainBtn.addEventListener('click', returnToMainMenu);
            }
            if (tryAgainBtn) {
                tryAgainBtn.addEventListener('click', returnToMainMenu);
            }

            // Expose functions to global scope for game.js to call
            window.showGameBackground = showGameBackground;
            window.showMainMenuBackground = showMainMenuBackground;

            // Add cooldown for card hover sound to prevent rapid-fire sound effect
            let lastHoverSoundTime = 0;
            const hoverSoundCooldown = 100; // milliseconds

            // Assuming SoundManager is globally accessible and has a playHoverSound method
            // Also assuming cards have a class 'card' and hover sound is triggered on mouseenter
            document.addEventListener('mouseenter', function(event) {
                if (event.target.classList.contains('card')) {
                    const now = Date.now();
                    if (now - lastHoverSoundTime > hoverSoundCooldown) {
                        if (window.SoundManager && typeof window.SoundManager.playHoverSound === 'function') {
                            window.SoundManager.playHoverSound();
                        }
                        lastHoverSoundTime = now;
                    }
                }
            }, true); // useCapture true to catch events in capture phase to reduce multiple triggers
        });

        // Initialize game function - called after splash screen is clicked
        function initializeGame() {
            window.pokerGame = new PokerGame();
        }
    </script>
</body>
</html>
